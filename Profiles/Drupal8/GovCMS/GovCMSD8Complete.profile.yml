title: 'GovCMS Drupal 8 Complete Audit'
format:
  html:
    template: govcms-page
policies:
  # Modules
  Drupal8:ModulesDisabled:
    severity: high
    parameters:
      modules:
        - clamav
        - googleanalytics
        - govcms_account_security
        - govcms_password_policy
        - govcms_tweaks
        - password_policy
        - robotstxt
        - seckit
        - shield
        - lagoon_logs
  GovCMSD8:SysLog:
    severity: normal
  GovCMSD8:DBLog:
    severity: normal
  GovCMSD8:Overlay:
    severity: normal
  GovCMSD8:PHP:
    severity: high
  GovCMSD8:Testing:
    severity: normal
  GovCMSD8:Statistics:
    severity: normal
  GovCMSD8:Update:
    severity: normal

  # permissions
  Drupal8:PermissionsBlackList:
    severity: critical
    parameters:
      roles:
        - 'anonymous'
        - 'authenticated'
        - 'admin'
      permissions :
        - 'add JS snippets for google analytics'
        - 'administer features'
        - 'administer govcms_dlm'
        - 'administer module permissions'
        - 'administer modules'
        - 'administer password policies'
        - 'administer permissions'
        - 'administer seckit'
        - 'administer site configuration'
        - 'administer software updates'
        - 'assign all roles'
        - 'generate features'
        - 'manage features'
        - 'rename features'

  Drupal:AnonSession:
    severity: normal
  #
  Drupal8:UserLockDown:
    severity: high
    parameters:
      blacklist : '(admin|root|drupal|god|govcms|paul|sean|ruwan)'
      email : 'no_reply@govcms.gov.au'
  #
  Drupal-8:UserRegistrationAdminOnly:
    severity: normal
  Drupal8:UserRoleCollector:
    severity: high
  Drupal-7:PSA-2016-003:
    severity: high

  #  # Performance
  Drupal-8:CssAggregation:
    severity: normal
  Drupal-8:JsAggregation:
    severity: normal
  Drupal-8:ErrorLevel:
    severity: normal
  Drupal-7:ImageDerivatives:
    severity: normal
  Drupal-7:CacheLifetime:
    severity: normal
  Drupal-7:PageCacheMaximumAge:
    severity: normal
    parameters:
      value : 300
  Drupal-7:Search404ModuleDisabled:
    severity: normal
  Drupal8:CronLast:
    severity: normal
  Drupal-7:PoorMansCronDisabled:
    severity: normal
  Drupal-7:ViewsCache:
    severity: normal
  Drupal-7:ViewsPagination:
    severity: normal
    parameters:
      limit : 100

  #  # GovCMS specific
  #  govCMS-D7:GoogleAnalyticsAccount:
  #    severity: normal
  #  govCMS-D7:PageviewsTracker:
  #    severity: normal
  #  govCMS-D7:RobotsTxt:
  #    severity: low
  #  govCMS-D7:DefaultDateTimezone:
  #    severity: low
  Drupal-7:XMLSitemapBaseURL:
    severity: low
    parameters:
      value : '^https://(www|ministerial|agency|blog|docs|annualreport|innovation|soe|news)\.[-a-z]{1,63}(\.[-a-z]{1,63})?\.gov\.au$'
  #  govCMS-D7:PageviewsTracker:
  #    severity: normal
  #  govCMS-D7:Services:
  #    severity: normal
  #  govCMS-D7:MaliciousWebformUpload:
  #    severity: normal
  GovCMSD8:Shield:
    severity: low
  #  # govCMS-D7:NoSiteFactoryThemeReference:
  #  #   severity: normal

  #  # Housekeeping
  Drupal:updates:
    severity: normal
  Database:Size:
    severity: normal
    parameters:
      max_size : 1000
      warning_size : 250
  Drupal-7:MissingModules:
    severity: normal
  Drupal-7:InstallTaskCompleted:
    severity: normal
  Drupal-7:ZenRegistryRebuild:
    severity: normal
  fs:largeFiles:
    severity: normal
    parameters:
      max_size : 20000000
  Drupal:largeFiles:
    severity: normal
    parameters:
      max_size : 20000000
  fs:SensitivePublicFiles:
    severity: high
    parameters:
      extensions:
        - sql #will likely indicate a data breach
  fs:SensitivePublicFiles:
    severity: normal
    parameters:
      extensions:
        - php
        - sh
        - py
        - bz2
        - gz
        - tar
        - tgz
        - zip

  #   Theme specific checks.
  Drupal:LintTheme:
    severity: low
    parameters:
      path: '/app/web/themes/custom/'
  fs:DrupalThemeDirectory:
    severity: normal
    parameters:
      path: '/app/web/themes/custom/'
      max_size : 50
  Drupal:ThemeSecurity:
    severity: normal
    parameters:
      path: '/app/web/themes/custom/'
      filetypes:
        - php
        - inc
        - theme
      patterns:
        - "_POST"
        - "exec\\("
        - "db_query"
        - "db_select"
        - "db_merge"
        - "db_update"
        - "db_write_record"
        - "\\->query"
        - "drupal_http_request"
        - "curl_init"
        - "passthru"
        - "proc_open"
        - "system\\("
        - "sleep\\("
        - "mysql_"
        - "mysqli"
        - "sqlite"
        - "db_query"
        - "db_fetch"
        - "db_result"
        - "pager_query"
        - "db_set_active"
        - "db_select"
        - "db_insert"
        - "db_update"
        - "db_delete"
        - "fetchAll"
        - "fetchField"
        - "fetchObject"
        - "fetchAssoc"
        - "countQuery"
